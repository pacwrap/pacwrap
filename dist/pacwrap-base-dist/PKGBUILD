#
# pacwrap-dist
# 
# Copyright (C) 2023-2024 Xavier R.M. <sapphirus@azorium.net>
# SPDX-License-Identifier: GPL-3.0-only
#
# This program is free software: you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation, version 3.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with this program.  If not, see <https://www.gnu.org/licenses/>.

pkgname=('pacwrap-base-dist')
pkgver=0.6.0
pkgrel=1
pkgdesc="Distribution package to configure Arch Linux for use with pacwrap."
arch=('any')
url="https://pacwrap.sapphirus.org/"
license=('GPLv3-only')

source=("${pkgname}-${pkgver}-${pkgrel}.tar.zst::${pkgname}-${pkgver}-${pkgrel}.tar.zst")
sha512sums=('bd9e31fb4d47fc8180af6de840146f23bb2aaf9a1e68001829688fbce3460b7407feb20af566e79b3299819d32fc674bf517870901c91a6cf9333c5154069903')

package() {
  conflicts=('pacwrap-base-dist')
  depends=('fakeroot' 'fakechroot' 'flatpak-xdg-utils')

  cd "${srcdir}"

	local pacman_hooks=('20-systemd-sysusers'
			    '30-systemd-tmpfiles' 
			    '30-systemd-daemon-reload-system'
			    '30-systemd-daemon-reload-user'
			    '30-systemd-sysctl'
			    '30-systemd-catalog'
			    '30-systemd-update'
		    	'30-systemd-udev-reload'
			    '30-systemd-hwdb'
		    	'dbus-reload')
	
	mkdir -p "${pkgdir}/etc/pacman.d/hooks/" "${pkgdir}/usr/local/bin/"
	for pacman_hook in ${pacman_hooks[@]}; do
		ln -s /dev/null "${pkgdir}/etc/pacman.d/hooks/${pacman_hook}.hook"; done
	
  ln -s /usr/lib/flatpak-xdg-utils/xdg-open "${pkgdir}/usr/local/bin/"
	ln -s /usr/lib/flatpak-xdg-utils/xdg-email "${pkgdir}/usr/local/bin/"

  install -Dm 644 "dist_src/0-pacwrap-dist.hook" "${pkgdir}/usr/share/libalpm/hooks/0-pacwrap-dist.hook" 
  install -Dm 644 "dist_src/42-trust-permission.hook" "${pkgdir}/usr/share/libalpm/hooks/42-trust-permission.hook"
  install -Dm 755 "dist_src/pacwrap-dist" "${pkgdir}/usr/share/libalpm/scripts/pacwrap-dist"
}
